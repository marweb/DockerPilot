# DockPilot Environment Configuration
# 
# Copy this file to .env and customize the values for your deployment.
# DO NOT commit the actual .env file to version control!
#
# Usage:
#   cp infra/.env.example infra/.env
#   nano infra/.env  # Edit the values

# =============================================================================
# GENERAL SETTINGS
# =============================================================================

# Log level for all services (trace, debug, info, warn, error, fatal)
LOG_LEVEL=info

# Node environment (production, development)
NODE_ENV=production

# =============================================================================
# PORT CONFIGURATION
# =============================================================================

# External ports exposed on the host machine
# Change these if the default ports are already in use
API_GATEWAY_PORT=3000
DOCKER_CONTROL_PORT=3001
TUNNEL_CONTROL_PORT=3002
WEB_PORT=8000

# =============================================================================
# API GATEWAY SERVICE (Authentication & RBAC)
# =============================================================================

# REQUIRED: JWT secret for token signing (minimum 32 characters)
# Generate a strong random string, e.g.:
#   openssl rand -base64 64
JWT_SECRET=change-this-to-a-secure-random-string-minimum-32-chars

# JWT token expiration time
JWT_EXPIRES_IN=1h

# Refresh token expiration time
REFRESH_TOKEN_EXPIRES_IN=14d

# Initial admin password (optional, but recommended for first setup)
# If set, an admin user will be created automatically on first run
# IMPORTANT: Change this after first login!
INITIAL_ADMIN_PASSWORD=change-me-immediately

# CORS allowed origins (comma-separated for multiple). Leave empty to allow all.
# Example for production: CORS_ORIGIN=https://dockpilot.example.com,http://localhost:8000
# CORS_ORIGIN=

# Internal URLs for service communication (usually no need to change)
DOCKER_CONTROL_URL=http://docker-control:3001
TUNNEL_CONTROL_URL=http://tunnel-control:3002

# Rate limiting configuration
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW=1 minute
RATE_LIMIT_ANON_MAX=60
RATE_LIMIT_AUTH_MAX=120

# Endpoint-specific rate limits
AUTH_LOGIN_RATE_LIMIT_MAX=20
AUTH_LOGIN_RATE_LIMIT_WINDOW_MS=600000
AUTH_LOGIN_IDENTITY_RATE_LIMIT_MAX=10
AUTH_LOGIN_IDENTITY_RATE_LIMIT_WINDOW_MS=600000
AUTH_SETUP_RATE_LIMIT_MAX=20
AUTH_SETUP_RATE_LIMIT_WINDOW_MS=1800000
AUTH_REFRESH_RATE_LIMIT_MAX=120
AUTH_REFRESH_RATE_LIMIT_WINDOW_MS=300000
HEAVY_OP_RATE_LIMIT_MAX=10
HEAVY_OP_RATE_LIMIT_WINDOW_MS=60000

# =============================================================================
# DOCKER CONTROL SERVICE
# =============================================================================

# Docker daemon connection
# For local Docker socket (default):
DOCKER_HOST=unix:///var/run/docker.sock
# For remote Docker (uncommon):
# DOCKER_HOST=tcp://docker-host:2376

# =============================================================================
# TUNNEL CONTROL SERVICE (Cloudflare Tunnels)
# =============================================================================

# Path to cloudflared binary (inside container)
CLOUDFLARED_PATH=/usr/local/bin/cloudflared

# Directory to store tunnel credentials
CREDENTIALS_DIR=/data/tunnels

# =============================================================================
# ADVANCED SETTINGS
# =============================================================================

# Data directory for API Gateway (SQLite DB stored at {DATA_DIR}/dockpilot.db)
# If db.json exists in same dir, it is migrated to SQLite on startup
DATA_DIR=/data

# Docker socket path on host (only change if using a custom Docker setup)
# DOCKER_SOCKET_PATH=/var/run/docker.sock

# =============================================================================
# SECURITY NOTES
# =============================================================================
#
# 1. JWT_SECRET: Must be at least 32 characters. Use a cryptographically secure
#    random string. Never share or expose this value.
#
# 2. INITIAL_ADMIN_PASSWORD: If set, an admin user 'admin' will be created.
#    Change this password immediately after first login!
#
# 3. In production, consider:
#    - Using HTTPS/TLS (configure nginx.conf or reverse proxy)
#    - Restricting access with firewall rules
#    - Running behind a VPN or internal network
#
# =============================================================================
